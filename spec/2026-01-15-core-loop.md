# Core Loop Spec

## Related Documentation
- [[README.md]] - Project overview
- [[AGENTS.md]] - Coding standards
- [[docs/notes/planning/2026-01-15-roadmap.md]] - Sprint roadmap
- [[spec/2026-01-15-myth-engine.md]] - Myth engine and miracles
- [[docs/notes/design/2026-01-15-aker-boundry-control-flow.md]] - Card system
- [[docs/notes/design/2026-01-15-aker-the-day-night-hinge-as-the-prestige-clock.md]] - Prestige mechanics
- [[spec/2026-01-15-champion-agency.md]] - Champion control
- [[docs/tasks/005-aker-scheduler.md]] - Aker scheduler implementation

## Vision & Signature
- Dual-scale role: **Day = embodied champion**, **Night = mythic governance** (`docs/notes/2026-01-11-fantasia-design-pass-turning-the-vibe-into-a-runnable-loop.md:3-54`).
- Hard transition: night only exists while the champion sleeps; any wake trigger snaps back to day (17.48.43.md:35-54).
- Fog regimes: champion LOS in day, aligned LOS + faith alignment at night (17.48.43.md:56-74).

## Day Mode (Embodied Loop)
- Champion actions: explore, fight, build/repair, solve crises, establish comms and logistics before sleep (17.48.43.md:21-34).
- Inputs: WASD/click to move, context-sensitive interactions (to be finalized). Champion has physical risk and limited view radius.
- Orders propagate via **physical channels** (voice, messengers, signal towers, tech/magic networks); no free god-camera during day (17.48.43.md:64-118).
- Player influence over colonists via “priorities as fields” (colony doctrines, role emphasis, risk posture, taboos) rather than direct micro (17.48.43.md:76-98).

## Night Mode (Pantheon Loop)
- Preconditions: champion must sleep safely; SleepPrep phase ensures beds, guards, alarms (state diagram 17.48.43.md:44-50).
- Capabilities: review intel from aligned LOS, issue edicts (production, defense, scouting), spend divine resources (faith/favor/wrath) on influence, queue long projects (17.48.43.md:29-34, 122-147).
- Divine resource model:
  - **Faith** from aligned actions/rituals.
  - **Favor** short-term currency (regens daily/rituals).
  - **Wrath/Attention** escalation meter; big miracles raise global response (17.48.43.md:122-151).
- Limits: divine actions affect environment/psychology/info/covenants, not direct unit puppeteering (17.48.43.md:132-151).

## World Geometry & LOD Tiles
- World represented as hex tiles with three fidelities: loaded tile (full physics), adjacent tiles (aggregated agents), far tiles (state machines) (17.48.43.md:152-178).
- Entering a tile: seed -> apply persisted deltas -> LOD fast-forward -> produce history log.

## Intent-Driven Threats
- Raids and crises arise from faction goals, intel, logistics, and world pressures, not RNG events (17.48.43.md:180-205).
- Storyteller becomes “world pressure system” influencing agents rather than random events.

## MVP Slice (from 17.48.43.md:226-244)
1. Single loaded tile + 6 neighbors (hex ring).
2. 6–10 agents with needs/roles/comms via messenger.
3. Day champion control: build+fight+talk.
4. Night mode: LOS omniscience from aligned, 3 lesser + 1 major divine power, edicts UI.
5. One neighboring faction with intent-driven raid (scout → decide → attack).

## Design Decisions to Lock (17.48.43.md:247-265)
1. Wake triggers (danger, needs, alarms?).
2. Exact divine spending units.
3. Day orders propagation (physical only vs hybrid).
4. Combat lethality.
5. Death permanence / succession.

## Communication Model
- Channel types (voice, messenger, signal towers, tech, magic) each with travel time, reliability, interception risk (17.48.43.md:100-118).
- Failure modes feed narrative (delays, intercepts, rumor distortion).

## Agent Architecture (17.48.43.md:76-98)
1. Hard sim layer: deterministic needs/pathing/combat.
2. Planner layer: GOAP/utility for tasks/roles.
3. Narration layer (LLM) for inner thoughts/lore; explains decisions rather than making them.

## Champion Prestige Loop
- Retirement mechanic: champion’s deeds convert into prestige tokens (Herald Marks/Solar Seals/Lunar Knots) during the **Aker Rite** (`docs/notes/2026-01-15-aker-the-day-night-hinge-as-the-prestige-clock.md` & `docs/notes/2026-01-15-oh-that-gives-me-a-great-idea-for-a-game-mechanic-i-was-thin.md`).
- Prestige spend unlocks social permissions, institutional inheritance, mythic artifacts, world edits, apprenticeships (17.07.52.md).
- Distillation tracks structural changes (bonds, conflicts resolved, institutions founded, routes opened, narratives stabilized) and outputs tokens + inheritance + baggage + candidate pool (17.07.54.md).
- Retirement triggers at day/night boundaries (Aker hinge) and ties into RimWorld-like storyteller pressure via prestige ledger.

## Deity Move System
- Major deities (Herald, Sun, Moon) each have Night, Day, and Always abilities with costs (favor, cred, attention) and phase gating (champion-asleep requirement for Night) (`docs/notes/2026-01-15-yea-let-s-do-it-major-deities-get-3-abilities-each-night-abi.md`).
- Lesser deities (Covenant, Hearth, Warden) provide condition-heavy single abilities (binding contracts, public relief, wild reckoning) (17.07.57.md).
- Move collisions resolve per conflict key using influence + favor – attention + cred – recency – resistance, plus seeded noise; winner gets primary effect, runner-up becomes complication (17.08.00.md:94-177).
- Moves emit **Signs** (omens, gossip, patrol prep) and set **Modifiers** (veil, tomorrow-law, whisper network) which bias event-family generators (ultimatum→raid, trial, schism, trade scarcity, wild reckoning, succession) (17.08.00.md:183-369).
- Candidate events scored by plausibility/pressure/telegraph/novelty; queue drives world reactions (17.08.00.md:373-415).

## Open Questions
- Champion control interface specifics (input scheme, UI scaffolding) to be defined.
- Divine action catalog and costs beyond initial triad.
- Communication failure feedback loops (UI warnings, logs).
- Sleep safety requirements and alarm mechanics.
- Succession consequences when champion dies unexpectedly (auto-retire? fail state?).
