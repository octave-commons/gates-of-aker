
From `backend/src/fantasia/sim/core.clj` + friends:

*   You already have a **tight authoritative sim loop** (`tick-once`, `tick!`) and a **WS broadcast stream** (`tick/event/trace`), with a React “myth debugger” UI.

*   The **myth substrate is real**:

    *   `facets.clj` = spreading activation + recall scoring

    *   `events.clj` = event archetypes + claim candidates (nice micro-DSL)

    *   `myth.clj` = buzz/tradition ledger + attribution probabilities

*   The world is still a **20×20 square grid**, with movement = neighbor stepping, no obstacles (besides “trees” as a set, which currently don’t block).


So the fastest path to “RimWorld-ish + champion + powers” is: keep the myth system, and swap in a real map + jobs + factions + decks in layers.

* * *

North Star MVP
--------------

A playable loop where:

*   You have a **hex map**, can **build walls**, and pawns **path around** them.

*   You directly control a **champion** (day actions).

*   When the champion **sleeps**, **deities play cards** (night abilities) and **telegraphs** appear.

*   There are **6 neighbor factions** (one per hex direction) each with a **deck** (and your deity uses the same schema, even if it’s player-driven).


* * *

Roadmap (milestones → sprints)
------------------------------

### Milestone 1 — Hex backbone + rendering

**Done means**

*   Backend world uses axial hex coords

*   Frontend renders hex tiles and selection correctly

*   WS snapshot includes enough map data to draw


### Milestone 2 — Walls + pathing + “ghost build”

**Done means**

*   You can place wall ghosts, pawns build them, movement routes around them (BFS/A\* ok)

*   Tile passability is authoritative (backend)


### Milestone 3 — Colony job loop (RimWorld skeleton)

**Done means**

*   Jobs queue + reservations

*   Minimal items: `wood`, `food`

*   Needs drive jobs: sleep/eat; build requires wood; wood comes from trees


### Milestone 4 — Champion control + Day/Night gate

**Done means**

*   Player issues champion move/action intents during day

*   Champion can sleep → night begins

*   Night unlocks deity moves (cards) only while asleep


### Milestone 5 — 6 neighbor factions (ring settlements)

**Done means**

*   7 settlements exist (player center + 6 neighbors)

*   Neighbors can scout/trade/raid causally (even dumb at first)


### Milestone 6 — Decks of cards + signs + collisions

**Done means**

*   Each neighbor faction has a deck and plays 0–1 cards per Aker boundary

*   Cards emit **Signs** + **Modifiers** (not “spawn raid”)

*   Those modifiers generate **EventCandidates** (ultimatum/trial/schism/trade/wild/etc.)

*   Collision resolution produces winner + complication


* * *

Sprint 1 plan (Hex backbone + rendering) — “make the map real”
--------------------------------------------------------------

### 1) Add hex math + coordinate conventions

Create `backend/src/fantasia/sim/hex.clj`

*    Choose axial coords `q r` (pointy-top recommended)

*    Define `dirs` (6 neighbors) and `neighbors`

*    Define `axial->cube`, `distance`, `ring`, `line` (line optional for now)

*    Define `in-bounds?` for a rectangular axial viewport or radius world


**Why now:** everything else (walls, 6 neighbors, ring settlements) becomes trivial once coords are axial.

### 2) Convert world state map representation

Refactor `initial-world` to store tiles in a hex-friendly structure.

*    Replace `:size [w h]` and square assumptions with something like:

    *   `:map/kind :hex`

    *   `:map/bounds {:shape :rect :w 30 :h 30}` or `{:shape :radius :r 18}`

    *   `:tiles { [q r] {:terrain :ground :structure nil :resource ...}}` (sparse ok)

*    Convert `:trees` from a set into tile resources (`{:resource :tree}`) so it’s consistent with walls later

*    Update agent positions from `[x y]` → `[q r]`


### 3) Update movement to hex neighbors

Replace `neighbors` and movement stepping.

*    `move-agent` should select from 6 neighbors

*    Keep the movement deterministic like you have, just swap neighbor set (for now)


### 4) Update snapshot payload

Frontend needs map data.

*    Add to `snapshot`:

    *   `:map {:kind :hex :bounds ...}`

    *   `:tiles` (at minimum: walls + trees + shrine locations)

*    Keep it lean: send only “non-ground” tiles initially (trees/walls/shrine markers)


### 5) Frontend: hex renderer

In `web/src/App.tsx` (or split into `HexCanvas.tsx`)

*    Implement axial→pixel for chosen orientation

*    Draw hex grid

*    Draw non-ground tiles (trees as marker, shrine as solid)

*    Click selection:

    *   pixel→axial (approx) → cube-round → axial

*    Draw agents on hex centers


**Sprint 1 exit test**

*   You can click a hex, place a shrine there, and pawns walk on hexes (even dumbly).


* * *

Sprint 2 plan (Walls + pathing + build ghosts) — “first RimWorld feeling”
-------------------------------------------------------------------------

### Backend

*    Tile passability (`:structure :wall` blocks)

*    WS op: `place_wall_ghost` at selected hex

*    Jobs:

    *   `:job/build-wall` consumes `wood` and turns ghost → wall

*    Pathing:

    *   Start with BFS for “next step” toward a target; upgrade to A\* later


### Frontend

*    Build tool: click to place wall ghost

*    Draw wall ghosts differently than built walls


**Exit test**

*   Build a small enclosure and watch pawns route around it.


* * *

Sprint 3 plan (Colony core) — “it runs without you”
---------------------------------------------------

*    Stockpile zone + hauling

*    Chop tree → wood stack

*    Eat/sleep loops that actually matter

*    Basic combat stub (optional): “melee hit” so raids aren’t pure UI yet


* * *

Decks (how the 6-deck requirement fits cleanly)
-----------------------------------------------

Once Milestones 1–5 exist, decks are easy to integrate because the map gives you:

*   6 directions → 6 neighbor settlements

*   real routes → meaningful Herald moves

*   walls + jobs → meaningful sabotage/raid outcomes


### Deck schema (keep it identical for player + AI)

*    `:card/phase` = `:day | :night | :always`

*    `:card/cost` = `{:favor n :attention n :cred n}`

*    `:card/keys` = primary collision keys (tile, route, claim, settlement)

*    `:card/effect` = emits `Signs` + sets `Modifiers` (never spawns raids directly)


* * *

Architectural guardrails (so it doesn’t collapse later)
-------------------------------------------------------

*   **Don’t delete your myth engine.** Keep `events/facets/myth` intact; instead, feed it better event sources (jobs, raids, trials, shortages).

*   **Make map authoritative in backend.** UI can do previews; backend decides truth.

*   **Keep network payload sparse.** Send only changed tiles / non-ground tiles at first.


* * *

If you say “continue” again, I’ll write the next concrete artifact
------------------------------------------------------------------

A Sprint 1 task list in “repo-ops” form:

*   proposed new namespaces and file layout

*   the exact world map shape (`:tiles` vs `:chunks`)

*   the hex pixel math choices (pointy vs flat) with the click-rounding approach

*   the WS message additions (ops + payload fields)


No diffs—just full-file replacements where it matters.
